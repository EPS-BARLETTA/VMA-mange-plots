const $=e=>document.querySelector(e),plan=loadJSON(KEY_PLAN,[]);function renderPlan(){const e=document.getElementById("tbodyPlan");e.innerHTML="",plan.forEach(((t,n)=>{const o=document.createElement("tr");o.innerHTML=`
      <td>${n+1}</td>
      <td>${t.duree}</td>
      <td>${t.pctVMA}%</td>
      <td>${t.runner}</td>
      <td>${t.blocks90}</td>
      <td><button data-i="${n}" class="btn btn-red text-xs px-2 py-1">Supprimer</button></td>
    `,e.appendChild(o)}))}renderPlan(),document.getElementById("tbodyPlan").addEventListener("click",(e=>{const t=e.target?.dataset?.i;void 0!==t&&(plan.splice(parseInt(t,10),1),saveJSON(KEY_PLAN,plan),renderPlan())})),document.getElementById("btnPreset1").addEventListener("click",(()=>{[{duree:"04:30",pctVMA:80,runner:"alternate"},{duree:"06:00",pctVMA:90,runner:"alternate"},{duree:"03:00",pctVMA:100,runner:"alternate"}].forEach((e=>plan.push({...e,blocks90:blocksOf90(mmssToSeconds(e.duree))}))),saveJSON(KEY_PLAN,plan),renderPlan()})),document.getElementById("btnClear").addEventListener("click",(()=>{plan.length=0,saveJSON(KEY_PLAN,plan),renderPlan()})),document.getElementById("btnAdd").addEventListener("click",(()=>{const e=document.getElementById("duree").value.trim()||"01:30",t=parseFloat(document.getElementById("pct").value),n=document.getElementById("runner").value;if(isNaN(t))return void alert("Renseigner %VMA");const o=mmssToSeconds(e),a=blocksOf90(o);plan.push({duree:e,pctVMA:t,runner:n,blocks90:a}),saveJSON(KEY_PLAN,plan),renderPlan()})),document.getElementById("btnExport").addEventListener("click",(()=>{const e="duree,pctVMA,runner,blocks90\n",t=plan.map((e=>[e.duree,e.pctVMA,e.runner,e.blocks90].join(","))).join("\n");download("seance_mange_plots.csv",e+t,"text/csv")})),document.getElementById("importCSV").addEventListener("change",(e=>{const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=()=>{const e=n.result.split(/\r?\n/).filter(Boolean),t=[];for(let n=1;n<e.length;n++){const[o,a,r,l]=e[n].split(",");t.push({duree:o,pctVMA:Number(a),runner:r,blocks90:Number(l)})}plan.length=0,plan.push(...t),saveJSON(KEY_PLAN,plan),renderPlan()},n.readAsText(t)})),document.getElementById("btnStart").addEventListener("click",(()=>{const e={nom:document.getElementById("a_nom").value.trim(),prenom:document.getElementById("a_prenom").value.trim(),classe:document.getElementById("a_classe").value.trim(),vma:parseFloat(document.getElementById("a_vma").value)},t={nom:document.getElementById("b_nom").value.trim(),prenom:document.getElementById("b_prenom").value.trim(),classe:document.getElementById("b_classe").value.trim(),vma:parseFloat(document.getElementById("b_vma").value)};if(!e.nom||!e.prenom||isNaN(e.vma)||!t.nom||!t.prenom||isNaN(t.vma))return void alert("Renseigner nom, prénom et VMA pour A et B.");0===plan.length?alert("Ajouter au moins un bloc dans la séance."):(saveJSON(KEY_RUNNERS,{A:e,B:t}),saveJSON(KEY_RESULTS,[]),location.href="./run.html")}));
